#!/usr/bin/python3

#import argparse
#import os
#import time
#import sys
import subprocess
import multiprocessing


# global counter
counter = multiprocessing.Value('i', 0)



def ip_is_reachable(ip):
    status = subprocess.run(["ping", "-w1", ip], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
    return True if status.returncode == 0 else False


def worker(ip):
    global counter
    if ip_is_reachable(ip):
        with counter.get_lock():
            counter.value += 1



if __name__ == "__main__":
    # public dns servers: google, cloudflare, quad9, opendns, comodo secure dns
    ip_list = ["8.8.8.8", "8.8.4.4", "1.1.1.1", "1.0.0.1", "9.9.9.9", "149.112.112.112", "208.67.222.222", "208.67.220.220", "8.26.56.26", "8.20.247.20"]

    pool = multiprocessing.Pool(len(ip_list))
    i = pool.map_async(worker, ip_list, chunksize=1)
    i.wait()
    
    print(counter.value, "of", len(ip_list), "reached")
